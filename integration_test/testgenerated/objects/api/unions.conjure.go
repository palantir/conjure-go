// This file was generated by Conjure and should not be manually edited.

package api

import (
	"context"
	"fmt"
	"strconv"

	safejson "github.com/palantir/pkg/safejson"
)

type ExampleUnion struct {
	typ         string
	str         *string
	strOptional **string
	other       *int
}

type exampleUnionDeserializer struct {
	Type        string   `json:"type"`
	Str         *string  `json:"str"`
	StrOptional **string `json:"strOptional"`
	Other       *int     `json:"other"`
}

func (u *exampleUnionDeserializer) toStruct() ExampleUnion {
	return ExampleUnion{typ: u.Type, str: u.Str, strOptional: u.StrOptional, other: u.Other}
}

func (u ExampleUnion) MarshalJSON() ([]byte, error) {
	return u.AppendJSON(nil)
}

func (u ExampleUnion) AppendJSON(out []byte) ([]byte, error) {
	out = append(out, '{')
	switch u.typ {
	default:
		out = append(out, "\"type\":"...)
		out = safejson.AppendQuotedString(out, u.typ)
	case "str":
		out = append(out, "\"type\":\"str\""...)
		if u.str != nil {
			out = append(out, ',')
			out = append(out, "\"str\""...)
			out = append(out, ':')
			out = safejson.AppendQuotedString(out, u.str)
		}
	case "strOptional":
		out = append(out, "\"type\":\"strOptional\""...)
		if u.strOptional != nil {
			out = append(out, ',')
			out = append(out, "\"strOptional\""...)
			out = append(out, ':')
			if u.strOptional != nil {
				optVal := *u.strOptional
				out = safejson.AppendQuotedString(out, optVal)
			} else {
				out = append(out, "null"...)
			}
		}
	case "other":
		out = append(out, "\"type\":\"other\""...)
		if u.other != nil {
			out = append(out, ',')
			out = append(out, "\"other\""...)
			out = append(out, ':')
			out = strconv.AppendInt(out, int64(u.other), 10)
		}
	}
	out = append(out, '}')
	return out, nil
}

func (u *ExampleUnion) UnmarshalJSON(data []byte) error {
	var deser exampleUnionDeserializer
	if err := safejson.Unmarshal(data, &deser); err != nil {
		return err
	}
	*u = deser.toStruct()
	return nil
}

func (u *ExampleUnion) AcceptFuncs(strFunc func(string) error, strOptionalFunc func(*string) error, otherFunc func(int) error, unknownFunc func(string) error) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return unknownFunc(u.typ)
	case "str":
		return strFunc(*u.str)
	case "strOptional":
		var strOptional *string
		if u.strOptional != nil {
			strOptional = *u.strOptional
		}
		return strOptionalFunc(strOptional)
	case "other":
		return otherFunc(*u.other)
	}
}

func (u *ExampleUnion) StrNoopSuccess(string) error {
	return nil
}

func (u *ExampleUnion) StrOptionalNoopSuccess(*string) error {
	return nil
}

func (u *ExampleUnion) OtherNoopSuccess(int) error {
	return nil
}

func (u *ExampleUnion) ErrorOnUnknown(typeName string) error {
	return fmt.Errorf("invalid value in union type. Type name: %s", typeName)
}

func (u *ExampleUnion) Accept(v ExampleUnionVisitor) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return v.VisitUnknown(u.typ)
	case "str":
		return v.VisitStr(*u.str)
	case "strOptional":
		var strOptional *string
		if u.strOptional != nil {
			strOptional = *u.strOptional
		}
		return v.VisitStrOptional(strOptional)
	case "other":
		return v.VisitOther(*u.other)
	}
}

type ExampleUnionVisitor interface {
	VisitStr(string) error
	VisitStrOptional(*string) error
	VisitOther(int) error
	VisitUnknown(typeName string) error
}

func (u *ExampleUnion) AcceptWithContext(ctx context.Context, v ExampleUnionVisitorWithContext) error {
	switch u.typ {
	default:
		if u.typ == "" {
			return fmt.Errorf("invalid value in union type")
		}
		return v.VisitUnknownWithContext(ctx, u.typ)
	case "str":
		return v.VisitStrWithContext(ctx, *u.str)
	case "strOptional":
		var strOptional *string
		if u.strOptional != nil {
			strOptional = *u.strOptional
		}
		return v.VisitStrOptionalWithContext(ctx, strOptional)
	case "other":
		return v.VisitOtherWithContext(ctx, *u.other)
	}
}

type ExampleUnionVisitorWithContext interface {
	VisitStrWithContext(context.Context, string) error
	VisitStrOptionalWithContext(context.Context, *string) error
	VisitOtherWithContext(context.Context, int) error
	VisitUnknownWithContext(ctx context.Context, typeName string) error
}

func NewExampleUnionFromStr(v string) ExampleUnion {
	return ExampleUnion{typ: "str", str: &v}
}

func NewExampleUnionFromStrOptional(v *string) ExampleUnion {
	return ExampleUnion{typ: "strOptional", strOptional: &v}
}

func NewExampleUnionFromOther(v int) ExampleUnion {
	return ExampleUnion{typ: "other", other: &v}
}
